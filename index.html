<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<title>Login Jurnal</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
<div class="row justify-content-center">
<div class="col-md-4">
<div class="card shadow">
<div class="card-body">

<h4 class="text-center mb-3">Login Jurnal</h4>

<input id="kelas" class="form-control mb-2" placeholder="Nama Kelas">
<input id="password" type="password" class="form-control mb-3" placeholder="Password">

<button class="btn btn-primary w-100" onclick="login()">Login</button>
<div id="error" class="text-danger mt-3 text-center"></div>

</div>
</div>
</div>
</div>
</div>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vREsrxPb4dcd0ZqOP1XJr_kumznsi6-6FAoSlbM80VMFp2uHu47fqGnF1clqy0Qvrc8PtBDZmVIoPcd/pub?output=csv";

async function sha256(text) {
  const buf = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(text));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,"0")).join("");
}

async function login() {
  const kelas = kelasInput.value.trim();
  const pass = password.value.trim();
  const hash = await sha256(pass);

  const csv = await fetch(CSV_URL).then(r => r.text());
  const rows = csv.split("\n").slice(1);

  let ok = false;

  rows.forEach(r => {
    const [k, h] = r.split(",");
    if (k?.trim() === kelas && h?.trim() === hash) ok = true;
  });

  if (ok) {
    sessionStorage.setItem("kelas", kelas);
    sessionStorage.setItem("login_time", Date.now());
    location.href = "dashboard.html";
  } else {
    error.innerText = "Login gagal";
  }
}
</script>

</body>
</html>
